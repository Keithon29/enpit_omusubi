<% dir_url = "https://www.google.co.jp/maps/dir"%>
<% @images.each do |image| %>
  <% dir_url = dir_url + "/" + image %>
<% end %>
<%= link_to "経路を表示", dir_url %>

<div id="map"></div>

<style>
html { height: 100% }
body { height: 100% }
#map { height: 100%; width: 100%}
</style>

<script src="http://maps.google.com/maps/api/js?key=AIzaSyBRJ6fc2mYbVoGi7BzZ2iFTmFMvR-dZQFk&language=ja"></script>

<script>
if(navigator.geolocation) {
  document.write("geolocation使える!");

  var options = {
    enableHighAccuracy: true,
    timeout: 5000,
    maximumAge: 0
  };

  function success(pos) {
    document.write("success関数内")
    var crd = pos.coords;

    // 緯度経度の取得
    var lat = crd.latitude;
    var lng = crd.longitude;

    document.write(lat);
    document.write(lng);
    
    //Google Mapsで住所を取得
    var geocoder = new google.maps.Geocoder();
    latlng = new google.maps.LatLng(lat, lng);
    geocoder.geocode({'latLng': latlng}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        document.getElementById('address').innerHTML = results[0].formatted_address;
      }
      else {
        alert("エラー" + status);
      }
    });
  }

  /*現在位置の取得に失敗した時に実行*/
  function error(err) {
    document.write("error関数内")
    document.write(err.code + err.message);
  }

  // 現在位置を取得する
  navigator.geolocation.getCurrentPosition(success, error, options);
  document.write("getCurrentPosition実行後");

}　else {
  document.write("使えない（泣）");
}

</script>
